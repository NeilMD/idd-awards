document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".filter-btn").forEach(t=>{t.classList.remove("active")}),this.classList.add("active");const n=this.getAttribute("data-filter");document.querySelectorAll(".section").forEach(t=>{t.classList.remove("active-section")}),document.getElementById(n).classList.add("active-section")})});const s=document.getElementById("submission-form"),h=document.getElementById("memory-image"),B=document.getElementById("image-preview"),L=document.getElementById("preview-img"),C=document.getElementById("remove-image"),D=document.querySelector(".gallery-grid");document.querySelectorAll(".filter-btn");const b=document.getElementById("submit-modal"),c=document.getElementById("memory-modal"),F=document.getElementById("modal-image"),T=document.getElementById("modal-title"),j=document.getElementById("modal-submitter"),R=document.getElementById("modal-description"),H=document.querySelectorAll(".close-modal"),d=document.getElementById("submit-memory"),I=document.getElementById("category"),m=document.getElementById("link-container"),y=document.getElementById("link"),O=document.getElementById("gallery-section"),$=window.location.origin+window.location.pathname,_=$+"/load-more";function G(){N()}function k(){I.value==="ux"||I.value==="web"?m.style.display="block":m.style.display="none"}document.getElementById("all").addEventListener("click",()=>u("all"));document.getElementById("graphic").addEventListener("click",()=>u("graphic"));document.getElementById("ux").addEventListener("click",()=>u("ux"));document.getElementById("web").addEventListener("click",()=>u("web"));function N(){h.addEventListener("change",X),C.addEventListener("click",w),s.addEventListener("submit",K),H.forEach(e=>{e.addEventListener("click",()=>{c.style.display="none",b.style.display="none"})}),window.addEventListener("click",e=>{e.target===c&&(c.style.display="none",b.style.display="none")})}function X(e){const n=e.target.files[0];if(n){const t=new FileReader;t.onload=function(o){if(e.target.files[0].size>2097152){alert("File should be less than 2mb."),e.target.value="";return}else L.src=o.target.result,B.style.display="block"},t.readAsDataURL(n)}}function w(){h.value="",L.src="#",B.style.display="none"}function z(){document.getElementById("submit-title").textContent="Notes",document.getElementById("modal-notes").innerHTML=`<span>
              If you have submitted before, you're previous submission will be overwritten.
            </span>
            <br/>
            <br/>
            <span>
              Please wait 1-2mins for the verification email to arrived. It may arrived on your junk/spam folder! 
            </span>
            <br/>
            <span>
              <small>(dev notes: we dont have smtp server, sorry ðŸ™‡)</small>
            </span>`}function K(e){e.preventDefault(),console.log("Prevent Default"),d.classList.add("button-disabled"),z(),b.style.display="block";const n=document.getElementById("submitter-name").value,t=document.getElementById("memory-title").value,o=document.getElementById("memory-description").value,i=document.getElementById("memory-image").files[0],S=document.getElementById("email").value,a=document.getElementById("category").value,q=document.getElementById("link").value;let g=[];if(!i){alert("Please select an image to upload");return}if(a==="ux"||a==="web"?(m.style.display="block",y.required=!0):(m.style.display="none",y.required=!1),(a==="ux"||a==="web")&&!y.value&&g.push("Please provide a valid link (URL) for UX or Web category."),!s.checkValidity()){s.querySelectorAll(":invalid").forEach(l=>{g.push(`${l.name} is invalid.`)}),alert(`Error: 
`+g.join(`
`)),d.classList.remove("button-disabled");return}const M=this.getAttribute("data-attr-submit"),U=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),p=new FileReader;p.onloadend=function(v){v.target.result,new Date().getTime();const l=new FormData;l.append("name",n),l.append("design_title",t),l.append("design_description",o),l.append("image",i),l.append("email",S),l.append("link",q),l.append("design_category",a),fetch(M,{method:"POST",headers:{"X-CSRF-TOKEN":U},body:l}).then(r=>r.ok?r.json():r.json().then(f=>{let E="";for(const[J,P]of Object.entries(f.errors))P.forEach(A=>{E+="<br/><span>"+A+"</span><br/>"});throw console.error("Error details:",f),E})).then(r=>{r.success&&(s.reset(),w()),d.classList.remove("button-disabled")}).catch(r=>{d.classList.remove("button-disabled"),document.getElementById("submit-title").textContent="Submission Failed: Unable to Submit Design",document.getElementById("modal-notes").innerHTML=r})},p.readAsDataURL(i)}function V(e){F.src=e.imageUrl,T.textContent=e.title,j.textContent=`Submitted by ${e.name}`,R.textContent=e.description,c.style.display="block"}G();const W=document.querySelectorAll(".gallery-item");W.forEach(e=>{e.addEventListener("click",n=>{let t={imageUrl:e.querySelector(".gallery-image").src,title:e.querySelector(".gallery-title").textContent,name:e.querySelector(".gallery-submitter").textContent.substring(3),description:e.querySelector(".gallery-description").textContent};V(t)})});document.getElementById("category").addEventListener("change",k);document.addEventListener("DOMContentLoaded",function(){k(),s.reset();const e=document.getElementById("load-more");new IntersectionObserver(t=>{if(t[0].isIntersecting){let i=document.getElementById("next-page-url").value;i&&x(i)}}).observe(e)});function x(e){let n=document.getElementById("next-page-category").value,t=e.includes("?page")?e+`&category=${n}`:e+`?category=${n}`;fetch(t).then(o=>o.json()).then(o=>{O.insertAdjacentHTML("beforeend",o.submissionsHtml);let i=document.querySelector("#next-page-url");i.value=o.nextPageUrl}).catch(o=>console.error("Error fetching more data:",o))}function u(e){console.log("tigres"),document.getElementById("next-page-url");let n=document.getElementById("next-page-category");n.value=e,D.innerHTML="",x(_)}
